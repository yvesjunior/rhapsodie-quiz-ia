# Architecture Document - Rhapsodie Quiz IA Platform

**Version:** 2.0  
**Date:** DÃ©cembre 2024  
**Status:** Design & Recommendations  
**Focus:** Rhapsody of Realities & Foundation School

---

## Table des MatiÃ¨res

1. [Vue d'ensemble](#1-vue-densemble)
2. [Topics et Leurs SpÃ©cificitÃ©s](#2-topics-et-leurs-spÃ©cificitÃ©s)
3. [Architecture Actuelle](#3-architecture-actuelle)
4. [Architecture RecommandÃ©e](#4-architecture-recommandÃ©e)
5. [Diagrammes d'Architecture](#5-diagrammes-darchitecture)
6. [Composants et Instances](#6-composants-et-instances)
7. [Services et APIs](#7-services-et-apis)
8. [Workflows et Flux d'Interaction](#8-workflows-et-flux-dinteraction)
9. [Patterns de Communication](#9-patterns-de-communication)
10. [DÃ©ploiement](#10-dÃ©ploiement)
11. [ScalabilitÃ©](#11-scalabilitÃ©)
12. [SÃ©curitÃ©](#12-sÃ©curitÃ©)
13. [Monitoring et ObservabilitÃ©](#13-monitoring-et-observabilitÃ©)

---

## 1. Vue d'ensemble

### 1.1 Principes Architecturaux

- **SÃ©paration des responsabilitÃ©s:** Chaque composant a un rÃ´le clair et bien dÃ©fini
- **Microservices-ready:** Architecture modulaire permettant une Ã©volution vers des microservices
- **API-First:** Toutes les interactions passent par des APIs REST bien dÃ©finies
- **ScalabilitÃ© horizontale:** PossibilitÃ© d'ajouter des instances selon la charge
- **RÃ©silience:** Gestion des erreurs et fallback mechanisms
- **SÃ©curitÃ©:** Authentification centralisÃ©e, validation des donnÃ©es, rate limiting

### 1.2 Stack Technologique

| Composant | Technologie | Version |
|-----------|------------|---------|
| Mobile App | Flutter | 3.10+ |
| Admin Panel | CodeIgniter | 3.x |
| AI API | Laravel | 12.x (Optionnel - Phase 6) |
| PDF Processor | Python | 3.10+ (Optionnel - Phase 6) |
| Database | MySQL | 8.0+ |
| Cache | Redis | 7.0+ |
| Queue | Laravel Queue / RabbitMQ | - |
| Search | Elasticsearch (optionnel) | 8.x |
| File Storage | Local / S3 | - |
| LLM | Ollama | Latest (Optionnel - Phase 6) |

---

## 2. Topics et Leurs SpÃ©cificitÃ©s

### 2.1 Vue d'Ensemble des Topics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              STRUCTURE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  TOPICS                                                                  â”‚
â”‚  â”œâ”€â”€ Foundation School (Training)                                       â”‚
â”‚  â”‚   â””â”€â”€ Categories = Modules                                           â”‚
â”‚  â”‚       â”œâ”€â”€ Module 1: Contenu + Quiz                                  â”‚
â”‚  â”‚       â”œâ”€â”€ Module 2: Contenu + Quiz                                  â”‚
â”‚  â”‚       â””â”€â”€ ...                                                        â”‚
â”‚  â”‚                                                                       â”‚
â”‚  â””â”€â”€ Rhapsody (Daily Quiz)                                              â”‚
â”‚      â””â”€â”€ Categories = Year â†’ Month â†’ Day                                â”‚
â”‚          â”œâ”€â”€ 2025                                                       â”‚
â”‚          â”‚   â”œâ”€â”€ January                                                â”‚
â”‚          â”‚   â”‚   â”œâ”€â”€ Day 1: Texte + Quiz                               â”‚
â”‚          â”‚   â”‚   â”œâ”€â”€ Day 2: Texte + Quiz                               â”‚
â”‚          â”‚   â”‚   â””â”€â”€ ...                                                â”‚
â”‚          â”‚   â””â”€â”€ ...                                                    â”‚
â”‚          â””â”€â”€ ...                                                        â”‚
â”‚                                                                          â”‚
â”‚  FEATURE GLOBALE                                                         â”‚
â”‚  â””â”€â”€ Contest (Daily Text + Quiz)                                        â”‚
â”‚      â””â”€â”€ Disponible pour TOUS les utilisateurs                          â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Comparaison Technique

| Aspect | Rhapsody | Foundation School | Contest |
|--------|----------|-------------------|---------|
| **Type** | Quiz quotidien | Training | Feature globale |
| **Structure Categories** | Year â†’ Month â†’ Day | Modules | (basÃ© sur Rhapsody) |
| **Contenu** | Texte + Quiz | Contenu + Quiz | Daily Text + Quiz |
| **AccÃ¨s** | Tous | Tous | **TOUS** |
| **RÃ©pÃ©tition quiz** | Non (1/jour) | Oui (illimitÃ©) | Non (1/jour) |
| **Contrainte temps** | Quotidien | âŒ Non | Quotidien |
| **Classement** | Oui | âŒ Non | Oui (global) |
| **Objectif** | Engagement | Apprentissage | CompÃ©tition |

### 2.3 Flux de DonnÃ©es SpÃ©cifiques

#### Rhapsody - Flux (Year â†’ Month â†’ Day)
```
Admin crÃ©e:
  Topic: Rhapsody
    â””â”€â”€ Category: 2025 (Year)
        â””â”€â”€ Category: January (Month)
            â””â”€â”€ Category: Day 1 (Day)
                â”œâ”€â”€ daily_text: "Texte du jour..."
                â””â”€â”€ Questions: [Q1, Q2, ... Q5]

Utilisateur:
  1. Navigue: 2025 â†’ January â†’ Day 1
  2. Lit le texte (+5 points)
  3. RÃ©pond au quiz (+0-5 points)
  4. Score ajoutÃ© au classement
```

#### Foundation School - Flux (Modules)
```
Admin crÃ©e:
  Topic: Foundation School
    â””â”€â”€ Categories (Modules):
        â”œâ”€â”€ Module 1: L'assurance du salut
        â”‚   â”œâ”€â”€ content_text / video / audio
        â”‚   â””â”€â”€ Questions: [Q1, Q2, ... Q10]
        â”œâ”€â”€ Module 2: La nouvelle crÃ©ation
        â””â”€â”€ ...

Utilisateur:
  1. SÃ©lectionne Module 1
  2. Ã‰tudie le contenu (self-paced)
  3. Passe le quiz (illimitÃ©)
  4. Quiz rÃ©ussi â†’ Module 2 dÃ©bloquÃ©
```

#### Contest - Flux Quotidien
```
SystÃ¨me (automatique):
  1. Ã€ 00:00 AM, rÃ©cupÃ¨re le Day Rhapsody du jour
  2. CrÃ©e un Contest basÃ© sur ce Day (5 questions)
  3. Contest disponible pour TOUS jusqu'Ã  23:59:59

Notifications Push (jusqu'Ã  complÃ©tion):
  - 08:00 AM â†’ "ðŸŒ… Bonjour! Le Rhapsody du jour est disponible."
  - 13:00 PM â†’ "â˜€ï¸ N'oubliez pas votre Rhapsody quotidien!"
  - 22:00 PM â†’ "ðŸŒ™ DerniÃ¨re chance! ComplÃ©tez avant minuit."

Utilisateur:
  1. ReÃ§oit notification (si non complÃ©tÃ©)
  2. AccÃ¨de au Contest du jour
  3. Lit le texte (+5 points)
  4. RÃ©pond au quiz de 5 questions (+0-5 points)
  5. Score ajoutÃ© au classement global
  6. Notifications cessent pour ce jour
```

### 2.4 Modes de Jeu - Flux

#### Solo Mode (Practice Mode)

**Concept:** Practice mode with random questions from a topic. Separate from category-specific quizzes.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Taps "Solo" on Home Screen
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SELECT TOPIC                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚Rhapsody â”‚ â”‚ Found.  â”‚ (+future)  â”‚
â”‚  â”‚   ðŸ“–    â”‚ â”‚ School  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Configures quiz settings
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QUIZ SETTINGS                       â”‚
â”‚                                      â”‚
â”‚  Questions: [5] [10] [15] [20]       â”‚
â”‚  Time:      [10s] [15s] [30s] [60s]  â”‚
â”‚                                      â”‚
â”‚         [START QUIZ]                 â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. System selects random questions
     â”‚    from ALL categories in topic
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QUIZ SCREEN                         â”‚
â”‚  - Random questions from topic       â”‚
â”‚  - Timer per question                â”‚
â”‚  - Progress indicator                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Submits answers
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESULTS                             â”‚
â”‚  - Score: 8/10 (80%)                 â”‚
â”‚  - Coin reward: +1 (if 100% & >5 Q)  â”‚
â”‚  - [Play Again] [Change Topic]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

QUESTION SOURCES:
â”œâ”€â”€ Rhapsody: ALL years â†’ months â†’ days
â””â”€â”€ Foundation: ALL modules (skip content, quiz only)

COIN REWARD RULE:
â”œâ”€â”€ 100% correct AND questions > 5 â†’ +1 coin
â””â”€â”€ Otherwise â†’ 0 coins
```

#### 1v1 Mode
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Challengerâ”‚              â”‚ Opponent â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                         â”‚
     â”‚ 1. SÃ©lectionne Topic    â”‚
     â”‚ 2. SÃ©lectionne Category â”‚
     â”‚ 3. Cherche adversaire   â”‚
     â”‚                         â”‚
     â”‚ 4. Envoie invitation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
     â”‚                         â”‚
     â”‚                         â”‚ 5. ReÃ§oit notification
     â”‚                         â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ 6. Accepte
     â”‚                         â”‚
     â”‚ 7. Battle commence      â”‚ 7. Battle commence
     â”‚    (mÃªmes questions)    â”‚    (mÃªmes questions)
     â”‚                         â”‚
     â”‚ 8. Soumet rÃ©ponses      â”‚ 8. Soumet rÃ©ponses
     â”‚                         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Results    â”‚
         â”‚ - Scores     â”‚
         â”‚ - Winner     â”‚
         â”‚ - Points     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Multiplayer Mode (Group Battle)

**Concept:** Groups are persistent communities, Group Battles are temporary competitions within those communities.

```
                    GROUP (Persistent)              GROUP BATTLES (Temporary)
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Group Owner  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. CrÃ©e groupe (une fois)
       â”‚ 2. Obtient code d'invitation
       â”‚ 3. Invite membres
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         GROUP "Mon Ã‰glise"           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Marie  â”‚ â”‚ Pierre â”‚ â”‚ Sarah  â”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ (owner)â”‚ â”‚(member)â”‚ â”‚(member)â”‚   â”‚â”€â”€â”€â”€â–¶â”‚ Battle #1           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚ Rhapsody Jan 15     â”‚
â”‚                                      â”‚     â”‚ Status: Completed   â”‚
â”‚  invite_code: "ABC123"               â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  members: 25                         â”‚
â”‚  created: 2024                       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚â”€â”€â”€â”€â–¶â”‚ Battle #2           â”‚
â”‚  RELATION: 1 Group â†’ N Battles       â”‚     â”‚ Foundation M1       â”‚
â”‚                                      â”‚     â”‚ Status: In Progress â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 4. Owner lance Battle (rÃ©pÃ©table)
       â”‚    - SÃ©lectionne Topic
       â”‚    - SÃ©lectionne Category
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           GROUP BATTLE #N            â”‚
â”‚  - Tous les membres peuvent jouer    â”‚
â”‚  - MÃªmes questions pour tous         â”‚
â”‚  - Temps limitÃ© (optionnel)          â”‚
â”‚  - RÃ©sultat: Classement du groupe    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. RÃ©sultats (par battle)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      BATTLE LEADERBOARD              â”‚
â”‚  1. Pierre - 95% (10/10)             â”‚
â”‚  2. Marie  - 85% (8/10)              â”‚
â”‚  3. Sarah  - 75% (7/10)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Distinction:**
- **Group** = The community container (like a club)
- **Group Battle** = A competition event within that community
- A user must **belong to a Group** before participating in its **Group Battles**

---

## 3. Architecture Actuelle

### 3.1 Diagramme d'Architecture Actuel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MOBILE APP (Flutter)                     â”‚
â”‚  - Single Instance                                           â”‚
â”‚  - BLoC/Cubit State Management                              â”‚
â”‚  - Hive Local Storage                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTPS/REST API
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ADMIN PANEL API (CodeIgniter/PHP)                    â”‚
â”‚  - Single Instance                                           â”‚
â”‚  - Monolithic Controller (Api.php)                          â”‚
â”‚  - Direct DB Access                                          â”‚
â”‚  Port: 8080                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ MySQL Connection
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE (MySQL)                                â”‚
â”‚  - elite_quiz_237                                            â”‚
â”‚  - Single Instance                                           â”‚
â”‚  Port: 3310                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AI SERVICES (OPTIONNEL - Phase 6)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ AI QCM API       â”‚         â”‚ PDF Processor    â”‚       â”‚
â”‚  â”‚ (Laravel)        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ (Python)         â”‚       â”‚
â”‚  â”‚ Port: 8000       â”‚  Queue  â”‚ - Ollama         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                              â”‚
â”‚  Note: Pour le dÃ©veloppement initial, utiliser des         â”‚
â”‚        questions manuelles crÃ©Ã©es via Admin Panel           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Limitations de l'Architecture Actuelle

1. **Monolithique:** Admin Panel API est un monolithe avec un seul contrÃ´leur
2. **Pas de cache:** Pas de systÃ¨me de cache pour les requÃªtes frÃ©quentes
3. **Pas de queue:** Traitement synchrone des tÃ¢ches longues
4. **Pas de load balancing:** Single point of failure
5. **Pas de sÃ©paration API/Web:** Admin Panel mÃ©lange API et interface web
6. **Pas de service de recherche:** Recherche basique en base de donnÃ©es
7. **Pas de monitoring:** Pas d'observabilitÃ© sur les performances

---

## 4. Architecture RecommandÃ©e

### 4.1 Architecture Cible (Phase 1 - Rhapsody + Foundation School)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MOBILE APP (Flutter)                     â”‚
â”‚  - Multiple Instances (iOS/Android)                         â”‚
â”‚  - Offline Support (Hive)                                   â”‚
â”‚  - Push Notifications (FCM)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTPS/REST API
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
        â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API GATEWAY    â”‚         â”‚   ADMIN API       â”‚
â”‚   (Nginx/LB)     â”‚         â”‚   (CodeIgniter)   â”‚
â”‚   - Routing      â”‚         â”‚   - Web UI        â”‚
â”‚   - Rate Limit   â”‚         â”‚   Port: 8080      â”‚
â”‚   - SSL/TLS       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
         â”‚                             â”‚
         â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CORE API SERVICES                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Quiz API    â”‚  â”‚  Group API   â”‚  â”‚  User API    â”‚    â”‚
â”‚  â”‚  Service     â”‚  â”‚  Service     â”‚  â”‚  Service     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                 â”‚                  â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Shared Services Layer                      â”‚   â”‚
â”‚  â”‚  - Authentication Service                          â”‚   â”‚
â”‚  â”‚  - Validation Service                              â”‚   â”‚
â”‚  â”‚  - Notification Service                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL      â”‚ â”‚    Redis     â”‚ â”‚   Queue      â”‚
â”‚   Primary    â”‚ â”‚    Cache     â”‚ â”‚   Worker     â”‚
â”‚   Port:3310  â”‚ â”‚   Port:6379  â”‚ â”‚   (Laravel)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AI SERVICES                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Laravel AI API  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  Python Processorâ”‚         â”‚
â”‚  â”‚  - QCM Storage   â”‚  HTTP   â”‚  - PDF Extract  â”‚         â”‚
â”‚  â”‚  - Validation    â”‚         â”‚  - Ollama Call   â”‚         â”‚
â”‚  â”‚  Port: 8000      â”‚         â”‚  - QCM Generate  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Architecture Cible (Phase 2 - Microservices)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MOBILE APP (Flutter)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTPS
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API GATEWAY                               â”‚
â”‚  - Kong / Traefik / Nginx                                    â”‚
â”‚  - Authentication                                            â”‚
â”‚  - Rate Limiting                                             â”‚
â”‚  - Request Routing                                            â”‚
â”‚  - Load Balancing                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
        â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Quiz        â”‚ â”‚  Group       â”‚ â”‚  User        â”‚
â”‚  Service     â”‚ â”‚  Service     â”‚ â”‚  Service     â”‚
â”‚  :3001       â”‚ â”‚  :3002       â”‚ â”‚  :3003       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL      â”‚ â”‚    Redis     â”‚ â”‚   RabbitMQ   â”‚
â”‚   Primary    â”‚ â”‚    Cache     â”‚ â”‚   Queue      â”‚
â”‚   + Replica  â”‚ â”‚   Cluster    â”‚ â”‚   Exchange   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AI SERVICES                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  AI API      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  PDF Worker  â”‚               â”‚
â”‚  â”‚  Service     â”‚  Queue  â”‚  (Python)     â”‚               â”‚
â”‚  â”‚  :4001       â”‚         â”‚  - Ollama    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Diagrammes d'Architecture

### 5.1 Vue d'Ensemble Globale - Phase 1

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MOBILE APPLICATION                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   iOS App    â”‚  â”‚ Android App  â”‚  â”‚   Web PWA    â”‚                â”‚
â”‚  â”‚  (Flutter)   â”‚  â”‚  (Flutter)   â”‚  â”‚  (Flutter)   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚         â”‚                 â”‚                  â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                           â”‚                                              â”‚
â”‚                    HTTPS/REST API                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API GATEWAY / LOAD BALANCER                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Nginx / Kong                                                 â”‚    â”‚
â”‚  â”‚  - SSL/TLS Termination                                        â”‚    â”‚
â”‚  â”‚  - Request Routing                                            â”‚    â”‚
â”‚  â”‚  - Rate Limiting                                              â”‚    â”‚
â”‚  â”‚  - Load Balancing                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin API   â”‚   â”‚  Admin API   â”‚   â”‚  Admin API   â”‚
â”‚  Instance 1   â”‚   â”‚  Instance 2   â”‚   â”‚  Instance 3   â”‚
â”‚  (CodeIgniter)â”‚   â”‚  (CodeIgniter)â”‚   â”‚  (CodeIgniter)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL      â”‚   â”‚    Redis     â”‚   â”‚   Queue      â”‚
â”‚   Primary    â”‚   â”‚    Cache     â”‚   â”‚   Workers    â”‚
â”‚   + Replica  â”‚   â”‚   (Cluster)  â”‚   â”‚   (3x)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ADMIN PANEL (Web)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  CodeIgniter Web Interface                                    â”‚    â”‚
â”‚  â”‚  - Content Management                                         â”‚    â”‚
â”‚  â”‚  - Question Validation                                        â”‚    â”‚
â”‚  â”‚  - User Management                                            â”‚    â”‚
â”‚  â”‚  - Analytics                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP API
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AI SERVICES                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ Laravel AI   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ PDF Processorâ”‚                      â”‚
â”‚  â”‚ API          â”‚   Queue      â”‚ (Python)     â”‚                      â”‚
â”‚  â”‚ Port: 8000   â”‚              â”‚ - Ollama     â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ - PyPDF      â”‚                      â”‚
â”‚                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Vue SimplifiÃ©e

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Mobile App  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTPS
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ API Gateway â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ Admin   â”‚        â”‚ Admin   â”‚       â”‚ Admin   â”‚
   â”‚ API 1  â”‚        â”‚ API 2   â”‚       â”‚ API 3   â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ MySQL   â”‚        â”‚ Redis   â”‚       â”‚ Queue   â”‚
   â”‚ DB      â”‚        â”‚ Cache   â”‚       â”‚ Workers â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         AI Services              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚ AI API   â”‚â—„â”€â”€â”€â”¤ PDF      â”‚  â”‚
        â”‚  â”‚          â”‚    â”‚ Worker   â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Composants et Instances

### 6.1 Recommandations d'Instances par Composant

#### 6.1.1 Mobile App (Flutter)

**Instances RecommandÃ©es:**
- **iOS App:** 1 instance (distribuÃ©e via App Store)
- **Android App:** 1 instance (distribuÃ©e via Play Store)
- **Web App (optionnel):** 1 instance (PWA)

**Architecture Interne:**
```
Mobile App Structure:
â”œâ”€â”€ Presentation Layer (UI)
â”‚   â”œâ”€â”€ Screens (83 files)
â”‚   â””â”€â”€ Widgets (20 files)
â”œâ”€â”€ Business Logic Layer
â”‚   â”œâ”€â”€ Features (131 files)
â”‚   â”‚   â”œâ”€â”€ Auth (Cubits)
â”‚   â”‚   â”œâ”€â”€ Quiz (Cubits)
â”‚   â”‚   â”œâ”€â”€ Groups (Cubits) [NEW]
â”‚   â”‚   â””â”€â”€ Leaderboard (Cubits)
â”œâ”€â”€ Data Layer
â”‚   â”œâ”€â”€ Remote Data Sources
â”‚   â”œâ”€â”€ Local Data Sources (Hive)
â”‚   â””â”€â”€ Repositories
â””â”€â”€ Core Layer
    â”œâ”€â”€ Config
    â”œâ”€â”€ Constants
    â”œâ”€â”€ Navigation
    â””â”€â”€ Utils
```

**Recommandations:**
- âœ… Conserver l'architecture BLoC/Cubit actuelle
- âœ… Ajouter un service de cache local pour les donnÃ©es frÃ©quentes
- âœ… ImplÃ©menter retry logic avec exponential backoff
- âœ… Ajouter offline mode avec sync automatique

#### 6.1.2 Admin Panel API (CodeIgniter)

**Instances RecommandÃ©es:**

| Phase | Instances | CPU | RAM | Port | Notes |
|-------|-----------|-----|-----|------|-------|
| **Development** | 1 | 1 core | 1GB | 8080 | Local dev |
| **Staging** | 2 | 2 cores | 2GB | 8080 | Load balanced |
| **Production** | 3-5 | 2 cores | 2GB | 8080 | Selon charge |

**Scaling Rules:**
- **Ajouter instance si:** CPU > 70% OU Response time > 500ms (p95)
- **RÃ©duire instance si:** CPU < 30% ET Response time < 200ms (p95)

**Refactoring RecommandÃ©:**

```
Current Structure:
Api.php (Monolithic - 3000+ lines)
â”œâ”€â”€ user_signup()
â”œâ”€â”€ get_questions()
â”œâ”€â”€ get_daily_quiz()
â””â”€â”€ ... (65+ methods)

Recommended Structure:
â”œâ”€â”€ Controllers/
â”‚   â”œâ”€â”€ Api/
â”‚   â”‚   â”œâ”€â”€ AuthController.php
â”‚   â”‚   â”œâ”€â”€ QuizController.php
â”‚   â”‚   â”œâ”€â”€ GroupController.php      [NEW]
â”‚   â”‚   â”œâ”€â”€ TopicController.php      [NEW]
â”‚   â”‚   â”œâ”€â”€ DailyTextController.php  [NEW]
â”‚   â”‚   â”œâ”€â”€ BattleController.php     [NEW]
â”‚   â”‚   â”œâ”€â”€ LeaderboardController.php
â”‚   â”‚   â””â”€â”€ UserController.php
â”‚   â””â”€â”€ Web/
â”‚       â”œâ”€â”€ Dashboard.php
â”‚       â”œâ”€â”€ Questions.php
â”‚       â””â”€â”€ ...
â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ AuthService.php
â”‚   â”œâ”€â”€ QuizService.php
â”‚   â”œâ”€â”€ GroupService.php              [NEW]
â”‚   â”œâ”€â”€ PointsService.php             [NEW]
â”‚   â””â”€â”€ ValidationService.php        [NEW]
â”œâ”€â”€ Repositories/
â”‚   â”œâ”€â”€ QuestionRepository.php
â”‚   â”œâ”€â”€ GroupRepository.php            [NEW]
â”‚   â””â”€â”€ ...
â””â”€â”€ Models/
    â””â”€â”€ (Eloquent-like models)
```

**Recommandations:**
- âœ… SÃ©parer API et Web controllers
- âœ… CrÃ©er une couche Service pour la logique mÃ©tier
- âœ… ImplÃ©menter Repository pattern pour l'accÃ¨s aux donnÃ©es
- âœ… Ajouter validation centralisÃ©e
- âœ… ImplÃ©menter rate limiting par endpoint

#### 6.1.3 Core API Services (Phase 2)

##### Service 1: Quiz Service

| Phase | Instances | CPU | RAM | Port |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 1GB | 3001 |
| Staging | 2 | 2 cores | 2GB | 3001 |
| Production | 3-5 | 2 cores | 2GB | 3001 |

**Responsibilities:**
- Gestion des questions
- Quiz quotidiens
- Validation des rÃ©ponses
- Calcul des scores

**Endpoints:**
- GET /api/v1/questions
- POST /api/v1/daily-quiz/validate
- GET /api/v1/daily-quiz/{date}
- POST /api/v1/quiz/submit

##### Service 2: Group Service

| Phase | Instances | CPU | RAM | Port |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 1GB | 3002 |
| Staging | 2 | 2 cores | 2GB | 3002 |
| Production | 2-3 | 2 cores | 2GB | 3002 |

**Responsibilities:**
- Gestion des groupes
- Membres de groupes
- Topics par groupe
- Permissions

**Endpoints:**
- GET /api/v1/groups
- POST /api/v1/groups
- POST /api/v1/groups/{id}/members
- GET /api/v1/groups/{id}/members
- POST /api/v1/groups/{id}/topics

##### Service 3: User Service

| Phase | Instances | CPU | RAM | Port |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 1GB | 3003 |
| Staging | 2 | 2 cores | 2GB | 3003 |
| Production | 2-3 | 2 cores | 2GB | 3003 |

**Responsibilities:**
- Gestion des utilisateurs
- Profils
- Authentification
- Points utilisateur

**Endpoints:**
- GET /api/v1/users/{id}
- PUT /api/v1/users/{id}
- GET /api/v1/users/{id}/points
- POST /api/v1/users/{id}/points

##### Service 4: Battle Service

| Phase | Instances | CPU | RAM | Port |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 1GB | 3004 |
| Staging | 1 | 2 cores | 2GB | 3004 |
| Production | 2 | 2 cores | 2GB | 3004 |

**Responsibilities:**
- Battles 1v1
- Invitations
- RÃ©sultats
- Points bonus

**Endpoints:**
- POST /api/v1/battles/challenge
- POST /api/v1/battles/{id}/accept
- POST /api/v1/battles/{id}/complete
- GET /api/v1/battles/{id}/status

##### Service 5: Leaderboard Service

| Phase | Instances | CPU | RAM | Port |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 1GB | 3005 |
| Staging | 1 | 2 cores | 2GB | 3005 |
| Production | 2 | 2 cores | 2GB | 3005 |

**Responsibilities:**
- Calcul des classements
- AgrÃ©gation des points
- Filtres multi-dimensionnels
- Cache des rÃ©sultats

**Endpoints:**
- GET /api/v1/leaderboard/daily
- GET /api/v1/leaderboard/weekly
- GET /api/v1/leaderboard/monthly
- GET /api/v1/leaderboard/yearly

**Query Params:** group_id, topic_id, version, limit, offset

##### Service 6: Notification Service

| Phase | Instances | CPU | RAM | Port |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 512MB | 3006 |
| Staging | 1 | 1 core | 1GB | 3006 |
| Production | 2 | 1 core | 1GB | 3006 |

**Responsibilities:**
- Push notifications
- Notifications in-app
- Emails (optionnel)
- SMS (optionnel)

**Endpoints:**
- POST /api/v1/notifications/send
- GET /api/v1/notifications/user/{id}
- POST /api/v1/notifications/mark-read

#### 6.1.4 Foundation School Service (Nouveau)

| Phase | Instances | CPU | RAM | Port |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 1GB | 3007 |
| Staging | 2 | 2 cores | 2GB | 3007 |
| Production | 2-3 | 2 cores | 2GB | 3007 |

**Responsibilities:**
- Gestion des classes et modules
- Progression des utilisateurs
- Quiz de modules
- Examens finaux
- GÃ©nÃ©ration de certificats
- Suivi pastoral

**Endpoints:**
- GET /api/v1/fs/classes
- GET /api/v1/fs/classes/{id}/modules
- GET /api/v1/fs/modules/{id}/content
- POST /api/v1/fs/modules/{id}/quiz/submit
- GET /api/v1/fs/progress
- POST /api/v1/fs/exams/{classId}/submit
- GET /api/v1/fs/certificates

#### 6.1.5 AI Services (Optionnel - Phase 4)

**Note:** Ces services sont optionnels et peuvent Ãªtre dÃ©veloppÃ©s aprÃ¨s les phases principales (1-5). Pour le dÃ©veloppement initial, utiliser des questions manuelles crÃ©Ã©es via l'interface Admin Panel.

##### AI API Service (Laravel)

| Phase | Instances | CPU | RAM | Port |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 2GB | 4001 |
| Staging | 1 | 2 cores | 4GB | 4001 |
| Production | 2 | 2 cores | 4GB | 4001 |

**Responsibilities:**
- RÃ©ception des questions gÃ©nÃ©rÃ©es
- Stockage temporaire
- Workflow de validation
- IntÃ©gration avec Admin Panel

**Endpoints:**
- POST /api/v1/qcm (from Python)
- GET /api/v1/qcm/pending
- PUT /api/v1/qcm/{id}/validate
- DELETE /api/v1/qcm/{id}

##### PDF Processor Worker (Python)

| Phase | Instances | CPU | RAM | Type |
|-------|-----------|-----|-----|------|
| Development | 1 | 2 cores | 2GB | Background |
| Staging | 2 | 2 cores | 2GB | Queue Worker |
| Production | 2-3 | 2 cores | 2GB | Queue Worker |

**Responsibilities:**
- Extraction de texte PDF
- DÃ©coupage en chunks
- Appels Ollama
- GÃ©nÃ©ration QCM
- Envoi vers AI API

**Configuration:**
- Workers: 2-3 instances (parallel processing)
- Queue: RabbitMQ / Laravel Queue
- Retry: 3 attempts with exponential backoff

#### 6.1.6 Infrastructure Services

##### API Gateway / Load Balancer

| Instance | Type | Ports | Configuration |
|----------|------|-------|----------------|
| nginx-lb-1 | Nginx | 80, 443 | SSL termination, routing |

**FonctionnalitÃ©s:**
- SSL/TLS termination
- Load balancing (round-robin / least-conn)
- Health checks
- Rate limiting
- Request/Response logging

**Recommandation:** 1 instance suffit (peut Ãªtre mis en cluster pour HA).

##### Cache Service (Redis)

| Phase | Instances | CPU | RAM | Type |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 1GB | Single |
| Staging | 1 | 2 cores | 2GB | Single |
| Production | 3 | 2 cores | 4GB | Cluster |

**Responsibilities:**
- Cache des questions frÃ©quentes
- Cache des classements
- Session storage
- Rate limiting counters
- Queue backend (optionnel)

**Configuration:**
- Memory: 2-4GB (scalable)
- Persistence: RDB + AOF
- Replication: Master-Slave (production)
- Eviction: allkeys-lru
- Max memory: 3GB (production)

**Usage:**
- Cache questions: 1h TTL
- Cache leaderboards: 1h-24h TTL
- Session storage: 24h TTL
- Rate limiting counters: 1h TTL

##### Queue Service

**Option 1: Laravel Queue (Redis/Database)**

| Phase | Workers | CPU | RAM | Type |
|-------|---------|-----|-----|------|
| Development | 1 | 1 core | 512MB | Single |
| Staging | 2 | 1 core | 1GB | Multiple |
| Production | 3-5 | 1 core | 1GB | Multiple |

**Queues:**
- `default`: TÃ¢ches gÃ©nÃ©rales
- `pdf-processing`: GÃ©nÃ©ration QCM (high priority)
- `leaderboard-calculation`: Calcul classements (scheduled)
- `notifications`: Envoi notifications (low priority)

**Option 2: RabbitMQ (RecommandÃ© Production)**

| Phase | Instances | CPU | RAM | Port |
|-------|-----------|-----|-----|------|
| Development | 1 | 1 core | 1GB | 5672 |
| Staging | 1 | 2 cores | 2GB | 5672 |
| Production | 1 + 1 | 2 cores | 2GB | 5672 (HA) |

**Workers:**
- PDF Processing: 2-3 workers
- Leaderboard: 1 worker (scheduled)
- Notifications: 2 workers

##### Database (MySQL)

| Phase | Instances | CPU | RAM | Storage | Type |
|-------|-----------|-----|-----|---------|------|
| Development | 1 | 2 cores | 4GB | 20GB | Single |
| Staging | 1 + 1 | 4 cores | 8GB | 50GB | Primary + Replica |
| Production | 1 + 2 | 4 cores | 8GB | 100GB+ | Primary + 2 Replicas |

**Configuration:**
- Engine: InnoDB
- Character Set: utf8mb4
- Connection Pool: 100-200
- Backup: Daily full + 6h incremental

**Scaling:**
- Vertical: Augmenter CPU/RAM si nÃ©cessaire
- Horizontal: Ajouter read replicas pour scaling reads

### 6.2 Plan de Scaling par Charge

#### ScÃ©nario 1: 1,000 Utilisateurs Actifs

```
Load Balancer: 1 instance
Admin API: 2 instances
MySQL: 1 primary
Redis: 1 instance
Queue Workers: 2 instances
AI API: 1 instance
PDF Workers: 1 instance

Total Estimated Cost: Low
```

#### ScÃ©nario 2: 10,000 Utilisateurs Actifs

```
Load Balancer: 1 instance (HA)
Admin API: 3 instances
MySQL: 1 primary + 1 replica
Redis: 1 instance (4GB)
Queue Workers: 3 instances
AI API: 2 instances
PDF Workers: 2 instances

Total Estimated Cost: Medium
```

#### ScÃ©nario 3: 100,000 Utilisateurs Actifs

```
Load Balancer: 2 instances (HA)
Admin API: 5 instances
Core Services: 2-3 instances each
MySQL: 1 primary + 2 replicas
Redis: Cluster (3 nodes)
Queue Workers: 5 instances
AI API: 3 instances
PDF Workers: 3 instances

Total Estimated Cost: High
```

---

## 7. Services et APIs

### 7.1 Structure des APIs

#### 7.1.1 Convention de Nommage

```
Base URL: https://api.rhapsodie-quiz.com/v1

Endpoints:
- Resources: /api/v1/{resource}
- Actions: /api/v1/{resource}/{id}/{action}
- Nested: /api/v1/{resource}/{id}/{nested-resource}

Examples:
GET  /api/v1/groups
POST /api/v1/groups
GET  /api/v1/groups/{id}
PUT  /api/v1/groups/{id}
DELETE /api/v1/groups/{id}
GET  /api/v1/groups/{id}/members
POST /api/v1/groups/{id}/members
```

#### 7.1.2 Format de RÃ©ponse Standard

```json
{
  "success": true,
  "data": {
    // Resource data
  },
  "meta": {
    "timestamp": "2024-12-21T10:00:00Z",
    "version": "1.0"
  }
}

Error Response:
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input data",
    "details": [
      {
        "field": "email",
        "message": "Email is required"
      }
    ]
  },
  "meta": {
    "timestamp": "2024-12-21T10:00:00Z"
  }
}
```

### 7.2 Services DÃ©taillÃ©s

#### 7.2.1 Quiz Service API (Rhapsody)

**Endpoints Principaux:**

```php
// Questions
GET    /api/v1/questions
POST   /api/v1/questions
GET    /api/v1/questions/{id}
PUT    /api/v1/questions/{id}
DELETE /api/v1/questions/{id}

// Daily Quiz
GET    /api/v1/daily-quiz/{date}
POST   /api/v1/daily-quiz/{date}/submit
GET    /api/v1/daily-quiz/{date}/text

// Question Validation (Admin)
GET    /api/v1/questions/pending
POST   /api/v1/questions/{id}/validate
PUT    /api/v1/questions/{id}/edit
DELETE /api/v1/questions/{id}/reject
```

#### 7.2.2 Foundation School Service API

**Endpoints Principaux:**

```php
// Classes
GET    /api/v1/fs/classes
GET    /api/v1/fs/classes/{id}
GET    /api/v1/fs/classes/{id}/modules

// Modules
GET    /api/v1/fs/modules/{id}
GET    /api/v1/fs/modules/{id}/content
POST   /api/v1/fs/modules/{id}/view         // Mark content as viewed
GET    /api/v1/fs/modules/{id}/quiz
POST   /api/v1/fs/modules/{id}/quiz/submit

// Progression
GET    /api/v1/fs/progress                  // User's overall progress
GET    /api/v1/fs/progress/class/{classId}  // Progress in specific class

// Exams
GET    /api/v1/fs/exams/{classId}           // Get exam questions
POST   /api/v1/fs/exams/{classId}/submit

// Certificates
GET    /api/v1/fs/certificates              // User's certificates
GET    /api/v1/fs/certificates/{id}/pdf     // Download certificate PDF

// Pastoral (Leader/Pastor endpoints)
GET    /api/v1/fs/pastoral/group/{groupId}/members
GET    /api/v1/fs/pastoral/member/{userId}/progress
POST   /api/v1/fs/pastoral/member/{userId}/allow-retry
POST   /api/v1/fs/pastoral/enroll           // Enroll user to FS
```

#### 7.2.3 Group Service API

**Endpoints Principaux:**

```php
// Groups
GET    /api/v1/groups
POST   /api/v1/groups
GET    /api/v1/groups/{id}
PUT    /api/v1/groups/{id}
DELETE /api/v1/groups/{id}

// Members
GET    /api/v1/groups/{id}/members
POST   /api/v1/groups/{id}/members
DELETE /api/v1/groups/{id}/members/{userId}
POST   /api/v1/groups/{id}/members/{userId}/promote

// Topics
GET    /api/v1/groups/{id}/topics
POST   /api/v1/groups/{id}/topics
DELETE /api/v1/groups/{id}/topics/{topicId}

// Invitations
POST   /api/v1/groups/{id}/invite
POST   /api/v1/groups/join/{code}
GET    /api/v1/groups/join-requests/{groupId}
POST   /api/v1/groups/join-requests/{requestId}/approve
```

#### 7.2.4 Leaderboard Service API

**Endpoints Principaux:**

```php
GET /api/v1/leaderboard/daily?group_id={id}&topic_id={id}&date={date}
GET /api/v1/leaderboard/weekly?group_id={id}&topic_id={id}&week={week}
GET /api/v1/leaderboard/monthly?group_id={id}&topic_id={id}&month={month}
GET /api/v1/leaderboard/yearly?group_id={id}&topic_id={id}&year={year}
GET /api/v1/leaderboard/all-time?group_id={id}&topic_id={id}
```

**Optimisations:**
- Cache Redis (TTL: 1 heure pour daily, 24h pour weekly/monthly)
- Calcul asynchrone via queue
- Pagination (limit: 50, offset)

---

## 8. Workflows et Flux d'Interaction

### 8.1 Flux GÃ©nÃ©ral - RequÃªte Utilisateur

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ (Mobile) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. HTTPS Request
     â”‚    GET /api/v1/daily-quiz/2024-12-21
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Gateway  â”‚
â”‚  - Auth      â”‚
â”‚  - Rate Limitâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Route to Service
     â”‚    Load Balance
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin API    â”‚
â”‚ Instance     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Check Cache
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Cache  â”‚      â”‚   MySQL     â”‚
â”‚ (Hit/Miss)   â”‚      â”‚   Database   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚
     â”‚ 4a. Cache Hit          â”‚ 4b. Cache Miss
     â”‚    Return Cached       â”‚    Query DB
     â”‚                        â”‚    Store in Cache
     â”‚                        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ 5. Response
                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  User    â”‚
         â”‚ (Mobile) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Flux d'Authentification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ (Mobile) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Sign in with Google
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firebase Authâ”‚
â”‚  - Verify    â”‚
â”‚  - Get Token â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Firebase ID Token
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Gateway  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. POST /api/user_signup
     â”‚    {firebase_id, type}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin API    â”‚
â”‚ - Verify     â”‚
â”‚ - Create/Get â”‚
â”‚   User       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Query/Create User
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL      â”‚
â”‚   Database   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 5. User Data
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin API    â”‚
â”‚ - Generate   â”‚
â”‚   JWT Token  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. JWT Token + User Data
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ (Mobile) â”‚
â”‚ Store    â”‚
â”‚ Token    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 Workflow: Rhapsody Quotidien

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ (Mobile) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 00:00 - Nouveau jour
     â”‚
     â”‚ 1. GET /api/v1/daily-text/{date}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin API    â”‚
â”‚ - Get Text   â”‚
â”‚ - Check Read â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Texte + status
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ Lit le   â”‚
â”‚ texte    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. POST /api/v1/daily-text/{date}/read
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Points       â”‚
â”‚ +2 pts       â”‚
â”‚ Quiz unlockedâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. GET /api/v1/daily-quiz/{date}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Quiz Service â”‚
â”‚ 10 questions â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 5. User answers
     â”‚
     â”‚ 6. POST /api/v1/daily-quiz/{date}/submit
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Score calc   â”‚
â”‚ +0-8 pts     â”‚
â”‚ Total: 10pts â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 7. Update leaderboard
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Leaderboard  â”‚
â”‚ Daily/Weekly â”‚
â”‚ Monthly      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 Workflow: Foundation School Module (Self-Paced Training)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ (Mobile) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. GET /api/v1/fs/progress
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FS Service   â”‚
â”‚ - Current    â”‚
â”‚   class      â”‚
â”‚ - Modules    â”‚
â”‚   status     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Module list with status
     â”‚    (locked/available/completed)
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ Selects  â”‚
â”‚ module   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. GET /api/v1/fs/modules/{id}/content
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FS Service   â”‚
â”‚ - Text       â”‚
â”‚ - Video URL  â”‚
â”‚ - Audio URL  â”‚
â”‚ - PDF URL    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. User studies content
     â”‚    (NO TIME LIMIT - self-paced)
     â”‚
     â”‚ 5. POST /api/v1/fs/modules/{id}/content-complete
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Progress     â”‚
â”‚ content_     â”‚
â”‚ completed    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. Quiz now available
     â”‚    GET /api/v1/fs/modules/{id}/quiz
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Quiz Service â”‚
â”‚ 10-15 Qs     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 7. User answers
     â”‚
     â”‚ 8. POST /api/v1/fs/modules/{id}/quiz/submit
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Result                                â”‚
â”‚                                       â”‚
â”‚ - Show correct answers                â”‚
â”‚ - Show explanations                   â”‚
â”‚                                       â”‚
â”‚ if quiz passed:                       â”‚
â”‚   - Module completed                  â”‚
â”‚   - Next module unlocked              â”‚
â”‚   - Points awarded (optional)         â”‚
â”‚                                       â”‚
â”‚ if not passed:                        â”‚
â”‚   - Can retry IMMEDIATELY             â”‚
â”‚   - NO limit on attempts              â”‚
â”‚   - Encourage to review content       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.5 Workflow: Foundation School Class Completion

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ (Mobile) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ Last module completed
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Class Completed!                      â”‚
â”‚                                       â”‚
â”‚ - Congratulations message             â”‚
â”‚ - Certificate available (optional)    â”‚
â”‚ - Next class unlocked automatically   â”‚
â”‚ - Notify pastor (optional)            â”‚
â”‚                                       â”‚
â”‚ NO final exam - completion by         â”‚
â”‚ finishing all modules                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Note:** Foundation School is TRAINING, not examination. There is:
- âŒ No timed exams
- âŒ No weekly deadlines
- âŒ No competitive leaderboard
- âœ… Self-paced learning
- âœ… Unlimited quiz retries
- âœ… Focus on understanding, not speed

### 8.6 Workflow: GÃ©nÃ©ration de Questions IA (Phase 4)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚
â”‚ (Web UI) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Upload PDF
     â”‚    December 2025 - Adult
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin Panel     â”‚
â”‚  - Store PDF     â”‚
â”‚  - Extract Dates â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. POST /api/v1/pdf/process
     â”‚    {pdf_path, month, year, version}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Queue Service   â”‚
â”‚  - Add Job       â”‚
â”‚  Priority: High  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Queue Job
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PDF Worker       â”‚
â”‚ (Python)         â”‚
â”‚ - Extract Text   â”‚
â”‚ - Chunk (1400w)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. For each chunk
     â”‚    Call Ollama API
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ollama LLM      â”‚
â”‚  - Generate QCM  â”‚
â”‚  - Retry if fail â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 5. Questions Generated
     â”‚    {question, options, answer, explanation}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Laravel AI API   â”‚
â”‚ - Store Questionsâ”‚
â”‚ - Status: Pendingâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. Questions in DB
     â”‚    tbl_question_validation
     â”‚    status = 'pending'
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin Panel     â”‚
â”‚  - Notification  â”‚
â”‚  - Show Pending â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 7. Admin Reviews
     â”‚    Validate/Edit/Delete
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validation API   â”‚
â”‚ - Update Status  â”‚
â”‚ - Link to Date   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 8. All Questions Validated
     â”‚    Daily Quiz Status â†’ 'ready'
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cron Job         â”‚
â”‚ (00:00 Daily)    â”‚
â”‚ - Activate Quiz  â”‚
â”‚ - Status â†’ 'active'
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.7 Workflow: Battle 1v1

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ (Mobile) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 00:00 - New Day Starts
     â”‚
     â”‚ 1. Open App
     â”‚    GET /api/v1/daily-text/2024-12-21
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Quiz Service â”‚
â”‚ - Get Text   â”‚
â”‚ - Check Read â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Return Daily Text
     â”‚    {bible_text, prayer_text}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ Reads    â”‚
â”‚ Text     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Mark as Read
     â”‚    POST /api/v1/daily-text/read
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Points Serviceâ”‚
â”‚ - Award 2pts  â”‚
â”‚ - Unlock Quiz â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Quiz Unlocked
     â”‚    GET /api/v1/daily-quiz/2024-12-21
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Quiz Service â”‚
â”‚ - Get 10 Q    â”‚
â”‚ - Randomize  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 5. Questions Displayed
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚
â”‚ Answers  â”‚
â”‚ Questionsâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. Submit Answers
     â”‚    POST /api/v1/quiz/submit
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Quiz Service â”‚
â”‚ - Calculate  â”‚
â”‚   Score      â”‚
â”‚ - Max 8pts   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 7. Update Points
     â”‚    Total: 2 (read) + 8 (quiz) = 10pts
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Points Serviceâ”‚
â”‚ - Store      â”‚
â”‚ - Update LB  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 8. Queue Leaderboard Update
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Queue Worker â”‚
â”‚ - Calculate  â”‚
â”‚   Rankings   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 9. Update Cache
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redis Cache  â”‚
â”‚ - Store LB   â”‚
â”‚ - TTL: 1h    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.8 Workflow: Battle 1v1 (DÃ©taillÃ©)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User A   â”‚         â”‚ User B   â”‚
â”‚(Challenger)â”‚       â”‚(Opponent)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚
     â”‚ 1. Select User B
     â”‚    POST /api/v1/battles/challenge
     â”‚    {opponent_id, group_id, topic_id}
     â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚Battle Serviceâ”‚          â”‚
â”‚- Create      â”‚          â”‚
â”‚  Battle      â”‚          â”‚
â”‚- Status:     â”‚          â”‚
â”‚  Pending     â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
     â”‚                    â”‚
     â”‚ 2. Send Notification
     â”‚                    â”‚
     â”‚                    â–¼
     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚            â”‚Notification  â”‚
     â”‚            â”‚Service       â”‚
     â”‚            â”‚- Push Notif   â”‚
     â”‚            â”‚- In-App      â”‚
     â”‚            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                 â”‚
     â”‚                 â”‚ 3. User B Sees Notification
     â”‚                 â”‚
     â”‚                 â–¼
     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚            â”‚ User B   â”‚
     â”‚            â”‚ Opens Appâ”‚
     â”‚            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                 â”‚
     â”‚                 â”‚ 4. Accept Challenge
     â”‚                 â”‚    POST /api/v1/battles/{id}/accept
     â”‚                 â”‚
     â”‚                 â–¼
     â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚            â”‚Battle Serviceâ”‚
     â”‚            â”‚- Status:     â”‚
     â”‚            â”‚  Accepted   â”‚
     â”‚            â”‚- Get Qs     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ 5. Both Users Get Questions
                  â”‚    Same questions (daily quiz)
                  â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚            â”‚              â”‚
     â–¼            â–¼              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ User A   â”‚ â”‚ User B   â”‚      â”‚
â”‚ Answers  â”‚ â”‚ Answers  â”‚      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
     â”‚            â”‚              â”‚
     â”‚ 6. Submit  â”‚ 6. Submit   â”‚
     â”‚    Answers â”‚    Answers  â”‚
     â”‚            â”‚              â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ 7. Calculate Scores
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚Battle Serviceâ”‚
         â”‚- Compare     â”‚
         â”‚- Determine   â”‚
         â”‚  Winner      â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ 8. Award Bonus Points
              â”‚    Winner: +5 points
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚Points Serviceâ”‚
     â”‚- Add Bonus   â”‚
     â”‚- Update LB   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.9 Workflow: Validation Admin

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚
â”‚ (Web UI) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Navigate to Validation
     â”‚    GET /admin/questions/pending
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin Panel  â”‚
â”‚ - Fetch      â”‚
â”‚   Pending    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Query Database
     â”‚    WHERE status = 'pending'
     â”‚    AND date = '2024-12-21'
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL      â”‚
â”‚   Database   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Return Questions
     â”‚    [{id, question, options, answer, explanation}]
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚
â”‚ Reviews  â”‚
â”‚ Questionsâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. For each question:
     â”‚    - Read question
     â”‚    - Check options
     â”‚    - Verify answer
     â”‚    - Review explanation
     â”‚
     â”‚    Action: Validate / Edit / Delete
     â”‚
     â”‚ 5a. Validate
     â”‚     POST /admin/questions/{id}/validate
     â”‚
     â”‚ 5b. Edit
     â”‚     PUT /admin/questions/{id}
     â”‚     {question, options, answer, explanation}
     â”‚     Then validate
     â”‚
     â”‚ 5c. Delete
     â”‚     DELETE /admin/questions/{id}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Validation APIâ”‚
â”‚- Update      â”‚
â”‚  Status      â”‚
â”‚- Link to Dateâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. Check if all questions validated
     â”‚    for date 2024-12-21
     â”‚
     â”‚    If YES:
     â”‚    - Update daily_quiz status â†’ 'ready'
     â”‚    - Notify admin
     â”‚
     â”‚    If NO:
     â”‚    - Keep status 'pending'
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL      â”‚
â”‚   Database   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.10 Architecture de DonnÃ©es

#### Relations entre EntitÃ©s Principales

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User      â”‚
â”‚  (tbl_user)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                  â”‚                  â”‚
       â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Group Member â”‚  â”‚ User Points  â”‚  â”‚   Battle      â”‚
â”‚(tbl_group_   â”‚  â”‚(tbl_user_    â”‚  â”‚(tbl_battle)   â”‚
â”‚  member)     â”‚  â”‚  points)     â”‚  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                  â”‚
       â”‚ N:1             â”‚ N:1               â”‚ N:1
       â”‚                 â”‚                  â”‚
       â–¼                 â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Group     â”‚  â”‚    Topic     â”‚  â”‚    Group     â”‚
â”‚(tbl_group)   â”‚  â”‚(tbl_topic)   â”‚  â”‚(tbl_group)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                  â”‚
       â”‚                 â”‚                  â”‚
       â”‚ N:N             â”‚ N:N              â”‚
       â”‚                 â”‚                  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Group Topic  â”‚
        â”‚(tbl_group_   â”‚
        â”‚  topic)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Daily Text   â”‚
â”‚(tbl_daily_   â”‚
â”‚  text)       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:N
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Question     â”‚
â”‚(tbl_question)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:1
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validation   â”‚
â”‚(tbl_question_â”‚
â”‚  validation) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Flux de DonnÃ©es: Points et Classements

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Action  â”‚
â”‚ - Read Text  â”‚
â”‚ - Answer Quizâ”‚
â”‚ - Win Battle â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Calculate Points
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Points  â”‚
â”‚(tbl_user_    â”‚
â”‚  points)     â”‚
â”‚ - user_id    â”‚
â”‚ - group_id   â”‚
â”‚ - topic_id   â”‚
â”‚ - date       â”‚
â”‚ - points     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Aggregate
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚              â”‚              â”‚              â”‚
       â–¼              â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Daily        â”‚ â”‚ Weekly       â”‚ â”‚ Monthly      â”‚ â”‚ Yearly        â”‚
â”‚ Leaderboard  â”‚ â”‚ Leaderboard  â”‚ â”‚ Leaderboard  â”‚ â”‚ Leaderboard   â”‚
â”‚ SUM by date  â”‚ â”‚ SUM by week  â”‚ â”‚ SUM by month â”‚ â”‚ SUM by year   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                 â”‚                â”‚
       â”‚                â”‚                 â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                 â”‚
                        â”‚ Cache Results   â”‚
                        â–¼                 â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Redis Cache  â”‚  â”‚   MySQL      â”‚
                â”‚ TTL: 1h      â”‚  â”‚   Views      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Patterns de Communication

### 9.1 Synchronous Communication

**UtilisÃ© pour:**
- RequÃªtes utilisateur (mobile â†’ API)
- Validation immÃ©diate
- Lecture de donnÃ©es

**Pattern:**
```
Mobile App â†’ API Gateway â†’ Service â†’ Database
         â†                â†         â†
```

### 9.2 Asynchronous Communication

**UtilisÃ© pour:**
- GÃ©nÃ©ration de questions (PDF â†’ QCM)
- Calcul des classements
- Envoi de notifications
- Traitement des battles

**Pattern avec Queue:**
```
Admin Panel â†’ Queue â†’ Worker â†’ Service â†’ Database
                    â†“
              (Retry Logic)
                    â†“
              (Dead Letter Queue)
```

### 9.3 Event-Driven Communication (Phase 2)

**UtilisÃ© pour:**
- Mise Ã  jour des classements
- Notifications en temps rÃ©el
- Synchronisation entre services

**Pattern:**
```
Service A â†’ Event Bus â†’ Service B, C, D
         (RabbitMQ / Kafka)
```

### 9.4 Matrice d'Interactions

| Composant Source | Composant Destination | Type | Protocole | FrÃ©quence |
|------------------|----------------------|------|-----------|-----------|
| Mobile App | API Gateway | Request/Response | HTTPS | Haute |
| API Gateway | Admin API | Request/Response | HTTP | Haute |
| Admin API | MySQL | Query | MySQL | TrÃ¨s Haute |
| Admin API | Redis | Get/Set | Redis | TrÃ¨s Haute |
| Admin Panel | Admin API | Request/Response | HTTP | Moyenne |
| Admin Panel | Queue | Job Submission | Queue | Basse |
| Queue | PDF Worker | Job Processing | Queue | Basse |
| PDF Worker | Ollama | API Call | HTTP | Moyenne |
| PDF Worker | AI API | Store Questions | HTTP | Basse |
| Admin API | Queue | Async Job | Queue | Moyenne |
| Queue Worker | MySQL | Update | MySQL | Moyenne |
| Queue Worker | Redis | Cache Update | Redis | Moyenne |
| Notification Service | Mobile App | Push | FCM | Basse |

---

## 10. DÃ©ploiement

### 10.1 Architecture de DÃ©ploiement (Phase 1)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LOAD BALANCER (Nginx)                     â”‚
â”‚                    SSL Certificate                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
        â–¼              â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin API   â”‚ â”‚  Admin API   â”‚ â”‚  Admin API   â”‚
â”‚  Instance 1  â”‚ â”‚  Instance 2  â”‚ â”‚  Instance 3  â”‚
â”‚  (Docker)    â”‚ â”‚  (Docker)    â”‚ â”‚  (Docker)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MySQL      â”‚ â”‚    Redis     â”‚ â”‚   Queue      â”‚
â”‚   Primary    â”‚ â”‚    Cache     â”‚ â”‚   Workers    â”‚
â”‚   (Docker)   â”‚ â”‚   (Docker)   â”‚ â”‚   (Docker)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 Docker Compose Configuration

**Recommandation pour Production:**

```yaml
services:
  # Load Balancer
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - admin-api-1
      - admin-api-2

  # Admin API Instances
  admin-api-1:
    build: ./admin
    environment:
      - DB_HOST=mysql
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis

  admin-api-2:
    build: ./admin
    environment:
      - DB_HOST=mysql
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis

  # Database
  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=${DB_PASSWORD}
      - MYSQL_DATABASE=elite_quiz_237
    volumes:
      - mysql-data:/var/lib/mysql
      - ./backups:/backups

  # Cache
  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data

  # Queue Workers
  queue-worker:
    build: ./admin
    command: php artisan queue:work --tries=3
    depends_on:
      - mysql
      - redis
    deploy:
      replicas: 3

volumes:
  mysql-data:
  redis-data:
```

### 10.3 DÃ©ploiement Progressif

**Ã‰tape 1: Monolithique avec Load Balancer**
- 2-3 instances Admin API
- Load balancer Nginx
- MySQL + Redis

**Ã‰tape 2: SÃ©paration API/Web**
- Admin Web Panel (sÃ©parÃ©)
- API Services (sÃ©parÃ©s)
- Communication via API

**Ã‰tape 3: Microservices**
- Services indÃ©pendants
- API Gateway
- Service Mesh (optionnel)

### 10.4 Recommandations par Environnement

#### Development

**Minimal Setup:**
- 1 instance de chaque service
- Pas de load balancer
- Pas de replicas
- Local storage

**Docker Compose:**
```yaml
services:
  admin-api: 1 instance
  mysql: 1 instance
  redis: 1 instance
  queue-worker: 1 instance
```

#### Staging

**Production-like Setup:**
- 2 instances API (load balanced)
- 1 primary + 1 replica MySQL
- 1 Redis instance
- 2 queue workers
- Monitoring basique

#### Production

**High Availability:**
- 3+ instances API (load balanced)
- 1 primary + 2 replicas MySQL
- Redis Cluster (3 nodes)
- 3+ queue workers
- Monitoring complet
- Auto-scaling configurÃ©

---

## 11. ScalabilitÃ©

### 11.1 StratÃ©gies de Scaling

#### Horizontal Scaling (RecommandÃ©)

**Admin API:**
- Ajouter des instances selon la charge
- Load balancer distribue les requÃªtes
- Stateless design (pas de session serveur)

**Database:**
- Read replicas pour les lectures
- Write sur primary uniquement
- Connection pooling

**Cache:**
- Redis Cluster (3+ nodes)
- Sharding par clÃ©

#### Vertical Scaling (Temporaire)

- Augmenter CPU/RAM des instances
- Solution rapide mais limitÃ©e

### 11.2 Optimisations de Performance

#### Caching Strategy

```php
// Questions frÃ©quentes
Cache::remember("questions:daily:{$date}", 3600, function() {
    return Question::whereDate('date', $date)->get();
});

// Classements (1h pour daily, 24h pour weekly/monthly)
Cache::remember("leaderboard:daily:{$groupId}:{$topicId}:{$date}", 3600, function() {
    return LeaderboardService::calculateDaily($groupId, $topicId, $date);
});

// User points (5 minutes)
Cache::remember("user:points:{$userId}:{$date}", 300, function() {
    return UserPoints::where('user_id', $userId)->where('date', $date)->first();
});
```

#### Database Optimizations

```sql
-- Indexes recommandÃ©s
CREATE INDEX idx_daily_quiz_date ON tbl_daily_quiz(date_published);
CREATE INDEX idx_user_points_user_date ON tbl_user_points(user_id, date);
CREATE INDEX idx_user_points_group_topic_date ON tbl_user_points(group_id, topic_id, date);
CREATE INDEX idx_battle_status_date ON tbl_battle(status, date);
CREATE INDEX idx_group_member_user ON tbl_group_member(user_id, status);
```

#### Query Optimization

- Utiliser `SELECT` spÃ©cifique (Ã©viter `SELECT *`)
- Pagination pour grandes listes
- Eager loading pour relations
- Query caching

### 11.3 Capacity Planning

**Estimations (10,000 utilisateurs actifs):**

| Composant | Instances | CPU | RAM | Storage |
|-----------|-----------|-----|-----|---------|
| Admin API | 3 | 2 cores | 2GB | - |
| MySQL | 1 primary + 1 replica | 4 cores | 8GB | 100GB |
| Redis | 1 | 2 cores | 4GB | - |
| Queue Workers | 3 | 1 core | 1GB | - |
| AI API | 2 | 2 cores | 4GB | - |
| PDF Workers | 2 | 2 cores | 2GB | - |

### 11.4 CoÃ»ts EstimÃ©s (Cloud Providers)

#### AWS

| Service | Instance Type | Monthly Cost (USD) |
|---------|---------------|-------------------|
| EC2 (API) | t3.medium (3x) | ~$90 |
| RDS MySQL | db.t3.medium | ~$60 |
| ElastiCache Redis | cache.t3.medium | ~$30 |
| Load Balancer | ALB | ~$20 |
| **Total** | | **~$200/month** |

#### DigitalOcean

| Service | Instance Type | Monthly Cost (USD) |
|---------|---------------|-------------------|
| Droplets (API) | 2GB RAM (3x) | ~$36 |
| Managed MySQL | 2GB RAM | ~$30 |
| Managed Redis | 1GB RAM | ~$15 |
| Load Balancer | Basic | ~$12 |
| **Total** | | **~$93/month** |

#### Google Cloud

| Service | Instance Type | Monthly Cost (USD) |
|---------|---------------|-------------------|
| Compute Engine | e2-medium (3x) | ~$75 |
| Cloud SQL | db-f1-micro | ~$10 |
| Memorystore Redis | basic | ~$30 |
| Load Balancer | Standard | ~$20 |
| **Total** | | **~$135/month** |

---

## 12. SÃ©curitÃ©

### 12.1 Authentification et Autorisation

**Mobile App:**
- Firebase Auth (Google, Apple)
- JWT tokens pour API
- Refresh tokens avec rotation

**Admin Panel:**
- Session-based auth
- RBAC (Role-Based Access Control)
- Permissions granulaires

**API Services:**
- Laravel Sanctum pour API tokens
- Rate limiting par utilisateur/IP
- CORS configuration stricte

### 12.2 SÃ©curitÃ© des DonnÃ©es

- **Encryption:** HTTPS/TLS 1.3
- **Database:** Encryption at rest
- **Sensitive Data:** Hashing (bcrypt pour passwords)
- **API Keys:** Stockage sÃ©curisÃ© (env variables)

### 12.3 Protection contre les Abus

- **Rate Limiting:**
  - Mobile API: 100 req/min par utilisateur
  - Public endpoints: 20 req/min par IP
  - Admin endpoints: 1000 req/min

- **Input Validation:**
  - Validation cÃ´tÃ© serveur (obligatoire)
  - Sanitization des inputs
  - Protection SQL injection (prepared statements)

- **DDoS Protection:**
  - Cloudflare / AWS Shield
  - Rate limiting au niveau gateway

---

## 13. Monitoring et ObservabilitÃ©

### 13.1 MÃ©triques Ã  Surveiller

**Application:**
- Response time (p50, p95, p99)
- Error rate (4xx, 5xx)
- Request rate (req/sec)
- Active users

**Infrastructure:**
- CPU usage
- Memory usage
- Disk I/O
- Network traffic
- Database connections

**Business:**
- Daily active users
- Quiz completions
- Battle participation
- Points distribution

### 13.2 Outils RecommandÃ©s

**Phase 1 (Simple):**
- Laravel Telescope (dev/staging)
- MySQL slow query log
- Nginx access logs
- Basic health checks

**Phase 2 (Production):**
- **APM:** New Relic / Datadog / Sentry
- **Logs:** ELK Stack / Loki
- **Metrics:** Prometheus + Grafana
- **Uptime:** UptimeRobot / Pingdom

### 13.3 Alertes

**Critiques:**
- Database down
- API error rate > 5%
- Response time > 2s (p95)
- Disk space < 20%

**Warnings:**
- CPU usage > 80%
- Memory usage > 85%
- Queue backlog > 1000 jobs
- Cache hit rate < 70%

---

## 14. Recommandations par Phase

### Phase 1: Rhapsody MVP (Mois 1-2)

**PrioritÃ©s:**
1. [ ] Backend: Tables Rhapsody, API texte/quiz/points
2. [ ] Mobile: Ã‰crans texte du jour, quiz, rÃ©sultats
3. [ ] Groupes et classements basiques
4. [ ] Monitoring basique

**Instances:**
- Admin API: 1-2 instances
- MySQL: 1 instance + backup
- Redis: 1 instance

### Phase 2: Foundation School MVP (Mois 3-4)

**PrioritÃ©s:**
1. [ ] Backend: Tables Foundation School, API progression
2. [ ] Mobile: Liste modules, lecteur contenu, quiz
3. [ ] Examens et certificats
4. [ ] Suivi pastoral

**Instances:**
- Admin API: 2 instances
- FS Service: 1-2 instances
- MySQL: 1 instance + backup
- Redis: 1 instance
- Queue Workers: 2 instances

### Phase 3: FonctionnalitÃ©s AvancÃ©es (Mois 5-6)

**PrioritÃ©s:**
1. [ ] Battles 1v1
2. [ ] Admin Panel amÃ©liorÃ©
3. [ ] Badges et rÃ©compenses
4. [ ] Performance optimizations

**Instances:**
- API Gateway: 1 instance
- Services: 2-3 instances chacun
- MySQL: 1 primary + 1 replica
- Redis: Cluster (3 nodes)

### Phase 4: IA et Scale (Mois 7+)

**PrioritÃ©s:**
1. [ ] GÃ©nÃ©ration automatique de questions
2. [ ] Auto-scaling
3. [ ] Monitoring avancÃ©
4. [ ] Multi-region (optionnel)

---

## 15. Checklist d'ImplÃ©mentation

### Phase 1 - Rhapsody MVP
- [ ] Tables: tbl_topic, tbl_daily_text, tbl_question, tbl_user_points
- [ ] API: daily-text, daily-quiz, points, leaderboard
- [ ] Mobile: Home, Quiz, Results, Profile, Leaderboard
- [ ] Admin: Gestion questions, textes quotidiens

### Phase 2 - Foundation School MVP
- [ ] Tables: tbl_fs_class, tbl_fs_module, tbl_fs_question, tbl_fs_enrollment
- [ ] Tables: tbl_fs_module_progress, tbl_fs_quiz_attempt, tbl_fs_certificate
- [ ] API: classes, modules, progress, exams, certificates
- [ ] Mobile: FS Home, Module List, Content Reader, Quiz, Certificate
- [ ] Admin: Gestion classes/modules, inscriptions

### Infrastructure
- [ ] Docker Compose avec MySQL + Redis
- [ ] Backup automatique
- [ ] SSL Certificates
- [ ] Monitoring basique (logs, health checks)

### Security
- [ ] JWT Authentication
- [ ] Rate Limiting
- [ ] Input Validation
- [ ] CORS Configuration

### Testing
- [ ] API Tests (Postman/Insomnia)
- [ ] Mobile Testing (iOS Simulator, Android Emulator)
- [ ] User Acceptance Testing

---

**Document crÃ©Ã© le:** DÃ©cembre 2024  
**DerniÃ¨re mise Ã  jour:** DÃ©cembre 2024  
**Version:** 2.0  
**Focus:** Rhapsody of Realities & Foundation School  
**Auteur:** Architecture Team
